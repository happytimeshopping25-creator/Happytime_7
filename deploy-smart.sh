#!/usr/bin/env bash
set -euo pipefail

# --- ุฑุณุงูุฉ ุงูููููุช ---
# ูููู ุชูุฑูุฑ ุฑุณุงูุฉ ูุฎุตุตุฉ ููุณูุท ุฃูู ููุณูุฑุจุช
# ูุซุงู: bash deploy-smart.sh "ุชุญุฏูุซ ุชุตููู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ"
COMMIT_MSG="${1:-chore: โจ ูุดุฑ ุชููุงุฆู ุฐูู}"

echo "โ ุจุฏุก ุนูููุฉ ุงููุดุฑ ุงูุฐููุฉ..."

# 1. ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
echo "๐งช ุฌุงุฑู ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ุงูุขููุฉ (Jest)..."
npm run test:cart
echo "โ ูุฌุญุช ุฌููุน ุงูุงุฎุชุจุงุฑุงุช!"

# 2. ุจูุงุก ุงููุดุฑูุน ููุฅูุชุงุฌ
echo "๐๏ธ ุฌุงุฑู ุจูุงุก ูุณุฎุฉ ุงูุฅูุชุงุฌ ูู ุงููุดุฑูุน (next build)..."
npm run build
echo "โ ุชู ุจูุงุก ุงููุดุฑูุน ุจูุฌุงุญ!"

# 3. ุฑูุน ุงูุชุบููุฑุงุช ุฅูู GitHub
echo "โ๏ธ ุฌุงุฑู ุฑูุน ุงูุชุบููุฑุงุช ุฅูู GitHub..."
git add -A
# ุงูุชุญูู ูู ูุฌูุฏ ุชุบููุฑุงุช ูุนูู ููููุช
if git diff-index --quiet HEAD --; then
    echo "โน๏ธ ูุง ุชูุฌุฏ ุชุบููุฑุงุช ุฌุฏูุฏุฉ ูุฑูุนูุง."
else
    git commit -m "$COMMIT_MSG"
    git push origin main
    echo "โ ุชู ุฑูุน ุงูุชุบููุฑุงุช ุฅูู GitHub!"
fi

# 4. ุงููุดุฑ ุนูู Firebase Hosting
echo "๐ ุฌุงุฑู ูุดุฑ ุงููุดุฑูุน ุนูู Firebase Hosting..."
firebase deploy --only hosting
echo "๐๐๐ ุงูุชูู ุงููุดุฑ ุจูุฌุงุญ! ูููุนู ุงูุขู ูุจุงุดุฑ. ๐๐๐"
